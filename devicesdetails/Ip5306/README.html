<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>IP5306 - Power management | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="IP5306 - Power management | .NET nanoFramework Documentation ">
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Ip5306/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="ip5306---power-management">IP5306 - Power management</h1>

<p>This chip is used mainly in power bank and embedded devices as a power management device. It is connected using I2C and allows to adjust the charging current,voltage, cutoff voltage. It has the capacity to light up 4 leds displaying the charge of the battery. This device is used in the M5Stack.</p>
<h2 id="documentation">Documentation</h2>
<p>The datasheet in Chinese can be found <a href="https://github.com/m5stack/M5-Schematic/blob/master/Core/IIC_IP5306_REG_V1.4.pdf">here</a>.</p>
<h2 id="usage">Usage</h2>
<p>As always when using I2C, you need to make sure you're using the right pins. En ESP32, you need the register the pins if not using the default one.</p>
<pre><code class="lang-csharp">Configuration.SetPinFunction(22, DeviceFunction.I2C1_CLOCK);
Configuration.SetPinFunction(21, DeviceFunction.I2C1_DATA);

I2cDevice i2c = new(new I2cConnectionSettings(1, Ip5306.SecondaryI2cAddress));
Ip5306 power = new(i2c);
</code></pre>
<p>Note the default address of the IP5306 is 0xEA, the address used in M5Stack is 0x75 (here setup as <code>SecondaryI2cAddress</code>).</p>
<h3 id="getting-access-to-the-properties">Getting access to the properties</h3>
<p>All properties can be adjusted and changed. He is an example how to display all of them:</p>
<pre><code class="lang-csharp">Debug.WriteLine($&quot;  AutoPowerOnEnabled: {power.AutoPowerOnEnabled}&quot;);
Debug.WriteLine($&quot;  BoostOutputEnabled: {power.BoostOutputEnabled}&quot;);
Debug.WriteLine($&quot;  BoostWhenVinUnpluggedEnabled: {power.BoostWhenVinUnpluggedEnabled}&quot;);
Debug.WriteLine($&quot;  BostEnabled: {power.BoostEnabled}&quot;);
Debug.WriteLine($&quot;  ButtonOffEnabled: {power.ButtonOffEnabled}&quot;);
Debug.WriteLine($&quot;  ChargerEnabled: {power.ChargerEnabled}&quot;);
Debug.WriteLine($&quot;  ChargingBatteryVoltage: {power.ChargingBatteryVoltage}&quot;);
Debug.WriteLine($&quot;  ChargingCurrent: {power.ChargingCurrent}&quot;);
Debug.WriteLine($&quot;  ChargingCutOffCurrent: {power.ChargingCutOffCurrent}&quot;);
Debug.WriteLine($&quot;  ChargingCuttOffVoltage{power.ChargingCuttOffVoltage}&quot;);
Debug.WriteLine($&quot;  ChargingLoopSelection: {power.ChargingLoopSelection}&quot;);
Debug.WriteLine($&quot;  ChargingUnderVoltage: {power.ChargingUnderVoltage}&quot;);
Debug.WriteLine($&quot;  ConstantChargingVoltage: {power.ConstantChargingVoltage}&quot;);
Debug.WriteLine($&quot;  FlashLightBehavior {power.FlashLightBehavior}&quot;);
Debug.WriteLine($&quot;  IsBatteryFull: {power.IsBatteryFull}&quot;);
Debug.WriteLine($&quot;  IsCharging: {power.IsCharging}&quot;);
Debug.WriteLine($&quot;  IsOutputLoadHigh: {power.IsOutputLoadHigh}&quot;);
Debug.WriteLine($&quot;  LightDutyShutdownTime: {power.LightDutyShutdownTime}&quot;);
Debug.WriteLine($&quot;  LowPowerOffEnabled: {power.LowPowerOffEnabled}&quot;);
Debug.WriteLine($&quot;  ShortPressToSwitchBosst: {power.ShortPressToSwitchBosst}&quot;);
Debug.WriteLine($&quot;  SwitchOffBoostBehavior: {power.SwitchOffBoostBehavior}&quot;);
Debug.WriteLine($&quot;  GetButtonStatus: {power.GetButtonStatus()}&quot;);
</code></pre>
<h3 id="button-status">Button status</h3>
<p>You can get the button status:</p>
<pre><code class="lang-csharp">var button = power.GetButtonStatus();
switch (button)
{
    case ButtonPressed.DoubleClicked:
        Debug.WriteLine(&quot;double clicked&quot;);
        break;
    case ButtonPressed.LongPressed:
        Debug.WriteLine(&quot;Long pressed&quot;);
        break;
    case ButtonPressed.ShortPressed:
        Debug.WriteLine(&quot;Short pressed&quot;);
        break;
    case ButtonPressed.NotPressed:
    default:
        break;
}
</code></pre>
<blockquote>
<p><strong>Important</strong>: depending on the behavior you setup for the button, the device may switch off what's connected to it. So be careful on what you setup. Once the I2C connection is broken, you can't adjust the behavior bck.</p>
</blockquote>
<h3 id="configuration-for-m5stack">configuration for M5Stack</h3>
<p>The configuration for M5Stack is the following:</p>
<pre><code class="lang-csharp">// Configuration for M5Stack
power.ButtonOffEnabled = true;
power.BoostOutputEnabled = false;
power.AutoPowerOnEnabled = true;
power.ChargerEnabled = true;
power.BoostEnabled = true;
power.LowPowerOffEnabled = true;
power.FlashLightBehavior = ButtonPress.Doubleclick;
power.SwitchOffBoostBehavior = ButtonPress.LongPress;
power.BoostWhenVinUnpluggedEnabled = true;
power.ChargingUnderVoltage = ChargingUnderVoltage.V4_55;
power.ChargingLoopSelection = ChargingLoopSelection.Vin;
power.ChargingCurrent = ElectricCurrent.FromMilliamperes(2250);
power.ConstantChargingVoltage = ConstantChargingVoltage.Vm28;
power.ChargingCuttOffVoltage = ChargingCutOffVoltage.V4_17;
power.LightDutyShutdownTime = LightDutyShutdownTime.S32;
power.ChargingCutOffCurrent = ChargingCutOffCurrent.C500mA;
power.ChargingCuttOffVoltage = ChargingCutOffVoltage.V4_2;
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Ip5306/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

