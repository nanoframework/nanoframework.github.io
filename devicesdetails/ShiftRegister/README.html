<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Generic shift register | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Generic shift register | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/ShiftRegister/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="generic-shift-register">Generic shift register</h1>

<p>A shift register enables controlling multiple devices, like LEDs, using a small number of pins (minimum of 3 -- data, data clock and register latch). Shift registers can be daisy-chained without requiring using additional pins, enabling addressing a large number of devices, limited only by current and the algorithms you use.</p>
<p>The <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/ShiftRegister/ShiftRegister.Shared/ShiftRegister.cs">ShiftRegister</a> binding abstracts the interaction with the storage register, the storage clock, the register clock and other shift register capabilities. This binding enables interaction via GPIO or SPI.</p>
<p><a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/ShiftRegister/ShiftRegister.Shared/ShiftRegister.cs">ShiftRegister</a> is used as the base class for <a href="../Sn74hc595/README.html">Sn74hc595</a> and <a href="../Mbi5027/README.html">Mbi5027</a> bindings. It can be used directly, or you can rely on it as an implementation detail of those more specific bindings. It has been tested with with <a href="https://www.ti.com/lit/ds/symlink/sn74hc595.pdf">SN74HC595</a>, <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5027.pdf">MBI5027</a>, and <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5168.pdf">MBI5168</a> shift registers.</p>
<p>The following image is of the popular SN74HC595 8-bit shift register:</p>
<p><img src="https://user-images.githubusercontent.com/2608468/84733283-ac3bca00-af52-11ea-8520-67c91a45c0f0.png" alt="shift-register"></p>
<p>The following image is of the larger MBI5027 16-bit shift register:</p>
<p><img src="https://user-images.githubusercontent.com/2608468/89208974-4216cd00-d572-11ea-98eb-14a9a9b4614f.png" alt="MBI5027"></p>
<p>The <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/ShiftRegister/samples">sample</a> demonstrates how to use the shift register in some basic ways.</p>
<h2 id="using-gpio">Using GPIO</h2>
<p>The binding can use <code>GpioController</code> pins to control the shift register. It uses <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/ShiftRegister/ShiftRegister.Shared/ShiftRegisterPinMapping.cs">ShiftRegisterPinMapping</a> to describe the pins that will be used.</p>
<p>The following example code demonstrates how to use a shift register with GPIO.</p>
<pre><code class="lang-csharp">ShiftRegister sr = new(ShiftRegisterPinMapping.Minimal, 8);

// Light up three of first four LEDs
sr.ShiftBit(1);
sr.ShiftBit(1);
sr.ShiftBit(0);
sr.ShiftBit(1);
sr.Latch();

// Display for 1s
Thread.Sleep(1000);

// Write to all 8 registers with a byte value
// ShiftByte latches data by default
sr.ShiftByte(0b_1000_1101);
</code></pre>
<p>The following <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Sn74hc595/sn74hc595-minimal-led-bar-graph.fzz">diagram</a> demonstrates the required wiring for using the SN74HC595 with minimal mapping. Other shift registers will be similar.</p>
<p><img src="../../devicesimages/Sn74hc595/sn74hc595-minimal-led-bar-graph_bb.png" alt="sn74hc595-led-bar-graph-spi_bb"></p>
<h2 id="using-spi">Using SPI</h2>
<p><strong>Important</strong>: make sure you properly setup the SPI pins especially for ESP32 before creating the <code>SpiDevice</code>, make sure you install the <code>nanoFramework.Hardware.ESP32 nuget</code>:</p>
<pre><code class="lang-csharp">//////////////////////////////////////////////////////////////////////
// when connecting to an ESP32 device, need to configure the SPI GPIOs
// used for the bus
Configuration.SetPinFunction(21, DeviceFunction.SPI1_MOSI);
Configuration.SetPinFunction(22, DeviceFunction.SPI1_MISO);
Configuration.SetPinFunction(23, DeviceFunction.SPI1_CLOCK);
// Make sure as well you are using the right chip select
</code></pre>
<p>For other devices like STM32, please make sure you're using the preset pins for the SPI bus you want to use. The chip select can as well be pre setup.</p>
<p>The bindings can use a <code>SpiDevice</code> to control the shift register. The shift register timing maps to the SPI protocol, enabling SPI to be used. The wiring from is straightforward, from <a href="https://pinout.xyz/pinout/spi">SPI pins</a> to the shift register: SDI (MOSI) -&gt; SDI; SCLK -&gt; CLK; CEO -&gt; LE.</p>
<p>Note: The SPI protocol has terms with <a href="https://hackaday.com/2020/06/29/updating-the-language-of-spi-pin-labels-to-remove-casual-references-to-slavery/">casual references to slavery</a>. We're doing our part to avoid them.</p>
<p>The following example code demonstrates how to use a shift register with SPI.</p>
<pre><code class="lang-csharp">// assuming an 8-bit shift register
ShiftRegister sr = new(SpiDevice.Create(new(1, 42)), 8);

// Light up three of first four LEDs
// The ShiftBit() method is disallowed when using SPI
sr.ShiftByte(0b_1011);

// Clear register
sr.ShiftClear();

// Write to all 8 registers with a byte value
sr.ShiftByte(0b_1010_1010);
</code></pre>
<p>The following <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Sn74hc595/sn74hc595-led-bar-graph-spi.fzz">diagram</a> demonstrates the required wiring for using the SN74HC595 with SPI. Other shift registers will be similar.</p>
<p><img src="../../devicesimages/Sn74hc595/sn74hc595-led-bar-graph-spi_bb.png" alt="sn74hc595-led-bar-graph-spi_bb"></p>
<h2 id="daisy-chaining">Daisy-chaining</h2>
<p>The binding supports daisy chaining, using either GPIO or SPI. The GPIO-based example below demonstrates how to instantiate the binding for controlling/addressing two -- daisy-chained -- 8-bit shift registers. This is specified by the integer value in the constructor.</p>
<pre><code class="lang-csharp">ShiftRegister sr = new(ShiftRegisterPinMapping.Minimal, 16);
</code></pre>
<p>The shift registers need to be correctly wired to enable daisy-chaining. On the SN74HC595, <code>QH'</code> in the first register would connect to <code>SER</code> in the second register. The pattern with the MBI5027 and MBI5168 is similar, <code>SDO</code> in the first register would connect to <code>SDI</code> in the second.</p>
<p>You can write values across multiple daisy chained devices in one of several ways, as demonstrated in the following code. You wouldn't typically use of all these approaches, but pick one.</p>
<pre><code class="lang-csharp">// Write a value to each register bit and latch
// Only works with GPIO
for (int i = 0; i &lt; sr.BitLength; i++)
{
    sr.ShiftBit(1);
}
sr.Latch();

// Prints the following pattern to each register: 10101010
// This pattern only works for register lengths divisible by 8 (which is common)
for (int i = 0; i &lt; sr.BitLength / 8; i++)
{
    sr.ShiftByte(0b_1010_1010);
}

// Downshift a 32-bit number to the desired number of daisy-chained devices
// Same thing could be done with a 64-bit integer if you have more than four 8-bit shift registers (or more than two 16-bit ones)
// Prints the following pattern across two registers: 0001001110001000
int value = 0b_0001_0011_1000_1000; // 5000
for (int i = (sr.BitLength / 8) - 1; i &gt; 0; i--)
{
    int shift = i * 8;
    int downShiftedValue = value &gt;&gt; shift;
    sr.ShiftByte((byte)downShiftedValue, false);
}

sr.ShiftByte((byte)value);

// Print array of bytes
// Result will be same as previous example
var bytes = new byte[] { 0b10001000, 0b00010011};
foreach (var b in bytes)
{
    sr.ShiftByte(b);
}
</code></pre>
<p>The following <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Sn74hc595/sn74hc595-minimal-led-bar-graph-double-up.fzz">diagram</a> demonstrates the required wiring for using the SN74HC595 with daisy-chaining. Other shift registers will be similar. This diagram uses the <code>Minimal</code> mapping. The <code>Complete</code> mapping will differ.</p>
<p><img src="../../devicesimages/Sn74hc595/sn74hc595-minimal-led-bar-graph-double-up_bb.png" alt="sn74hc595-minimal-led-bar-graph-double-up_bb"></p>
<h2 id="resources">Resources</h2>
<ul>
<li>SN74HC595 data sheet: <a href="https://www.ti.com/lit/ds/symlink/sn74hc595.pdf">https://www.ti.com/lit/ds/symlink/sn74hc595.pdf</a></li>
<li>MBI5027 data sheet: <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5027.pdf">http://archive.fairchip.com/pdf/MACROBLOCK/MBI5027.pdf</a></li>
<li>MBI5168 data sheet: <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5168.pdf">http://archive.fairchip.com/pdf/MACROBLOCK/MBI5168.pdf</a></li>
<li>Tutorial: <a href="https://www.youtube.com/watch?v=6fVbJbNPrEU">https://www.youtube.com/watch?v=6fVbJbNPrEU</a></li>
<li>Tutorial: <a href="https://www.youtube.com/watch?v=G1SzTGZ2l1c">https://www.youtube.com/watch?v=G1SzTGZ2l1c</a></li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/ShiftRegister/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

