<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>AXP192 - Enhanced single Cell Li-Battery and Power System Management IC | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="AXP192 - Enhanced single Cell Li-Battery and Power System Management IC | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Axp192/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="axp192---enhanced-single-cell-li-battery-and-power-system-management-ic">AXP192 - Enhanced single Cell Li-Battery and Power System Management IC</h1>

<h2 id="documentation">Documentation</h2>
<p>-Product documentation can be found <a href="https://m5stack.oss-cn-shenzhen.aliyuncs.com/resource/docs/datasheet/core/AXP192_datasheet_en.pdf">here</a>.
-Registers can be found <a href="https://m5stack.oss-cn-shenzhen.aliyuncs.com/resource/docs/datasheet/core/AXP192_datasheet_cn.pdf">here</a> (Chineese only, note: bing translator make miracle).</p>
<ul>
<li>This sensor is used in the <a href="https://docs.m5stack.com/en/core/m5stickc">M5Stick</a>. Initialization code for this device can be found <a href="https://github.com/m5stack/M5StickC/blob/master/src/AXP192.cpp">here</a>.</li>
</ul>
<h2 id="usage">Usage</h2>
<pre><code class="lang-csharp">// Make sure you configure properly the I2C pins, here example for ESP32
Configuration.SetPinFunction(22, DeviceFunction.I2C1_CLOCK);
Configuration.SetPinFunction(21, DeviceFunction.I2C1_DATA);

I2cDevice i2cAxp192 = new(new I2cConnectionSettings(1, Axp192.I2cDefaultAddress));
Axp192 power = new Axp192(i2cAxp192);
</code></pre>
<blockquote>
<p><strong>Important</strong>: make sure you read th documentation of your battery and setup the proper charging values, stop current. Overcharging your battery may damage it.</p>
</blockquote>
<h3 id="using-the-button">Using the button</h3>
<p>One button is available and can be setup to track short and long press:</p>
<pre><code class="lang-csharp">// This part of the code will handle the button behavior
power.EnableButtonPressed(ButtonPressed.LongPressed | ButtonPressed.ShortPressed);
power.SetButtonBehavior(LongPressTiming.S2, ShortPressTiming.Ms128, true, SignalDelayAfterPowerUp.Ms32, ShutdownTiming.S10);
</code></pre>
<p>The status is kept in the registers up to the next status read. You can then have both a short and a long press, you can get the status like this:</p>
<pre><code class="lang-csharp">var status = power.GetButtonStatus();
if ((status &amp; ButtonPressed.ShortPressed) == ButtonPressed.ShortPressed)
{
    Debug.WriteLine(&quot;Short press&quot;);
}
else if ((status &amp; ButtonPressed.LongPressed) == ButtonPressed.LongPressed)
{
    Debug.WriteLine(&quot;Long press&quot;);
}
</code></pre>
<h3 id="battery-status">Battery status</h3>
<p>You can get various elements regarding the battery status:</p>
<pre><code class="lang-csharp">Debug.WriteLine($&quot;Battery:&quot;);
Debug.WriteLine($&quot;  Charge curr  : {power.GetBatteryChargeCurrent().Milliamperes} mA&quot;);
Debug.WriteLine($&quot;  Status       : {power.GetBatteryChargingStatus()}&quot;);
Debug.WriteLine($&quot;  Dicharge curr: {power.GetBatteryDischargeCurrent().Milliamperes} mA&quot;);
Debug.WriteLine($&quot;  Inst Power   : {power.GetBatteryInstantaneousPower().Milliwatts} mW&quot;);
Debug.WriteLine($&quot;  Voltage      : {power.GetBatteryVoltage().Volts} V&quot;);
Debug.WriteLine($&quot;  Is battery   : {power.IsBatteryConnected()} &quot;);
</code></pre>
<h3 id="advanced-features">Advanced features</h3>
<p>The AXP192 can charge the battery, get and set charging current, cut off voltage, has protection for temperature. Most feature can be access or setup. You can check out the <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Axp192/samples">sample</a> to get more details on how to set those advance features.</p>
<blockquote>
<p>Note: this binding uses UnitsNet for the units like Voltage, Amperes.</p>
</blockquote>
<p>Here is an example reading the current, voltage:</p>
<pre><code class="lang-csharp">Debug.WriteLine($&quot;Temperature : {power.GetInternalTemperature().DegreesCelsius} °C&quot;);
Debug.WriteLine($&quot;Input:&quot;);
// Note: the current and voltage will show 0 when plugged into USB.
// To see something else than 0, you should output those data on a serial port for example
// Or display on the screen.
Debug.WriteLine($&quot;  Current   : {power.GetInputCurrent().Milliamperes} mA&quot;);
Debug.WriteLine($&quot;  Voltage   : {power.GetInputVoltage().Volts} V&quot;);
Debug.WriteLine($&quot;  Status    : {power.GetInputPowerStatus()}&quot;);
Debug.WriteLine($&quot;  USB volt  : {power.GetUsbVoltageInput().Volts} V&quot;);
Debug.WriteLine($&quot;  USB Curr  : {power.GetUsbCurrentInput().Milliamperes} mA&quot;);
</code></pre>
<h3 id="coulomb-counter">Coulomb counter</h3>
<p>The AXP192 has a Coulomb counter where the value is in mili Amperes per hour (this one is not yet using UnitsNet). You first have to enable the Counter and then you can read the value. It is recommended to let some time between the moment you enable and read the data. Features to reset, stop the count are available as well</p>
<pre><code class="lang-csharp">power.EnableCoulombCounter();
// Do something here
// You can then read periodically the Coulomb counter:
Debug.WriteLine($&quot;Coulomb: {power.GetCoulomb()} mA/h&quot;);
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Axp192/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

