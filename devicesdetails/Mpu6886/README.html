<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Mpu6886 - accelerometer and gyroscope | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Mpu6886 - accelerometer and gyroscope | .NET nanoFramework Documentation ">
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Mpu6886/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="mpu6886---accelerometer-and-gyroscope">Mpu6886 - accelerometer and gyroscope</h1>

<p>The MPU-6886 is a 6-axis motion tracking sensor that combines a 3-axis gyroscope and a 3-axis accelerometer including the following features:</p>
<ul>
<li>gyroscope programmable FSR of ±250 dps, ±500 dps, ±1000 dps, and ±2000 dps</li>
<li>accelerometer with programmable FSR of ±2g, ±4g, ±8g, and ±16g</li>
</ul>
<h2 id="documentation">Documentation</h2>
<ul>
<li><a href="https://m5stack.oss-cn-shenzhen.aliyuncs.com/resource/docs/datasheet/core/MPU-6886-000193%2Bv1.1_GHIC_en.pdf">Datasheet</a>, register descriptions start at page 32.</li>
<li>This sensor is used in for example the <a href="https://shop.m5stack.com/products/m5stickc-plus-esp32-pico-mini-iot-development-kit">M5StickC Plus development kit</a>, initialization code can be found <a href="https://github.com/m5stack/M5StickC/blob/3e00ecfa0897a432995a3f80874715cbe6ad60ee/src/utility/MPU6886.cpp#L32">here</a>.</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Create the <code>Mpu6886</code> class and pass the I2C device. By default the I2C address for this sensor is <code>0x68</code>.</p>
<pre><code class="lang-csharp">// I2C pins need to be configured, for example for pin 22 &amp; 21 for 
// the M5StickC Plus. These pins might be different for other boards.
Configuration.SetPinFunction(22, DeviceFunction.I2C1_CLOCK);
Configuration.SetPinFunction(21, DeviceFunction.I2C1_DATA);

I2cConnectionSettings settings = new(1, Mpu6886AccelerometerGyroscope.DefaultI2cAddress);

using (Mpu6886AccelerometerGyroscope ag = new(I2cDevice.Create(settings)))
{
    Debug.WriteLine(&quot;Start calibration ...&quot;);
    var offset = ag.Calibrate(1000);
    Debug.WriteLine($&quot;Calibration done, calculated offsets {offset.X} {offset.Y} {offset.Y}&quot;);

    Debug.WriteLine($&quot;Internal temperature: {ag.GetInternalTemperature().DegreesCelsius} C&quot;);

    while (true)
    {
        var acc = ag.GetAccelerometer();
        var gyr = ag.GetGyroscope();
        Debug.WriteLine($&quot;Accelerometer data x:{acc.X} y:{acc.Y} z:{acc.Z}&quot;);
        Debug.WriteLine($&quot;Gyroscope data x:{gyr.X} y:{gyr.Y} z:{gyr.Z}\n&quot;);
        Thread.Sleep(100);
    }
}
</code></pre>
<h3 id="sample-output">Sample output</h3>
<pre><code class="lang-text">Start calibration ...
Calibration done, calculated offsets 49.189 -86.21099999 -86.21099999
Internal temperature: 64.21664626 C
Accelerometer data x:-0.041503906 y:0 z:1.056884765
Gyroscope data x:4.94384765 y:-8.60595703 z:-15.68603515

Accelerometer data x:-0.040771484 y:-0.0051269531 z:1.062988281
Gyroscope data x:4.94384765 y:-7.56835937 z:-15.014648437

Accelerometer data x:-0.046630859 y:-0.0068359375 z:1.055175781
Gyroscope data x:3.60107421 y:-7.62939453 z:-15.1977539

Accelerometer data x:-0.049560546 y:-0 z:1.061279296
Gyroscope data x:4.39453125 y:-7.32421875 z:-14.28222656
</code></pre>
<p>See <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Mpu6886/samples">https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Mpu6886/samples</a> for a complete sample application.</p>
<h2 id="calibration">Calibration</h2>
<p>The gyroscope can be calibrated using the <code>Calibrate</code> function. With the <code>iterations</code> parameter
you can specify how many values should be read from the sensor to calculate an average (1000 iterations seems
to be a good number). During the calibration you want to keep the sensor still and in a fixed position (e.g. lying
flat on a table). The <code>Calibrate</code> function will write the values to the corresponding compensation registers
of the sensor, values are corrected when retrieved automatically.</p>
<p>The return value of the <code>Calibrate</code> method gives a vector containing the 3 (for the X,Y and Z axes) calculated
compensation values.</p>
<pre><code class="lang-csharp">var offset = ag.Calibrate(1000);
Debug.WriteLine($&quot;Calibration done, calculated offsets {offset.X} {offset.Y} {offset.Y}&quot;);
</code></pre>
<p>It is possible to write directly to the compensation registers using the <code>SetGyroscopeOffset</code> function. You might
want to do this when you create your own custom calibration method, or you retrieve existing calibration data from
a persisted data store or memory location.</p>
<p>⚠ <strong>When the devices reboots, the offset registers are cleared.</strong> So if you don't persist the calibration data yourself
you will have to run the calibration method every time the device boots.</p>
<h2 id="sleep-mode">Sleep mode</h2>
<p>The sensor can be put in sleep mode by calling the <code>Sleep</code> function. After that the <code>WakeUp</code> function should be called.</p>
<h2 id="setting-scales">Setting scales</h2>
<p>Both for the gyroscope and accelerometer you can set the desired scales using the <code>AccelerometerScale</code> and <code>GyroscopeScale</code>
properties.</p>
<pre><code class="lang-csharp">// Set the scale of the accelerometer to 2G
ag.AccelerometerScale = AccelerometerScale.Scale2G;
</code></pre>
<h2 id="setting-enabled-axes">Setting enabled axes</h2>
<p>By default all gyroscope and accelerometer axes are enabled. If desired you can specify explicitly which axes should be enabled.
In that case, all other axes will be disabled. When an axis is disabled, data can still be read for that axis but the values will not
change anymore.</p>
<pre><code class="lang-csharp">// Enable only the X axis of the gyroscope and accelerometer
ag.EnabledAxes = EnabledAxis.GyroscopeX | EnabledAxis.AccelerometerX;
</code></pre>
<h2 id="features-not-implemented">Features not implemented</h2>
<p>The following features are enabled in the MPU6886 but not yet implemented in this driver:</p>
<ul>
<li>registers <code>0x05</code> to <code>0x0b</code>: low noise to low power offset</li>
<li>registers <code>0x0d</code> to <code>0x0F</code>: self test</li>
<li>register <code>0x1a</code>: FIFO mode, DLPF (digital low pass filter)</li>
<li>register <code>0x1d</code> bit 0 to 3: DLPF</li>
<li>register <code>0x1e</code> bit 4 to 6: averaging filter for low power mode</li>
<li>registers <code>0x20</code> to <code>0x22</code>: threshold for wake-on motion</li>
<li>register <code>0x36</code>: fsync interrupt status</li>
<li>register <code>0x37</code>: INT/DRDY pin config</li>
<li>register <code>0x39</code> and <code>0x3a</code>: FIFO watermark interrupt</li>
<li>register <code>0x60</code> and <code>0x61</code>: FIFO watermark interrupt</li>
<li>register <code>0x68</code>: signal path reset</li>
<li>register <code>0x69</code>: acc. intelligence control</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Mpu6886/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

