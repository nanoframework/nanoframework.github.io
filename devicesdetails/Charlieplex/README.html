<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Charlieplex Segment binding | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Charlieplex Segment binding | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Charlieplex/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="charlieplex-segment-binding">Charlieplex Segment binding</h1>

<p><a href="https://en.wikipedia.org/wiki/Charlieplexing">Charliplexing</a> is a multiplexing scheme that enables controlling a significantly larger number of LEDs or other load or sensor than a <a href="https://github.com/dotnet/iot/tree/main/samples/led-blink">more traditional wiring scheme</a> would allow. Charlieplexing enables addressing up to <code>n^2-n</code> LEDs where n is the number of pins available. For example, 3 pins can be used to address up to 6 LEDs, 4 pins can address 12, and 5 pins can address 20. That sounds great, however charlieplexed circuits are hard to wire due to their complexity.</p>
<p>An even bigger challenge is that the scheme (at least in its basic form) only allows for lighting a single LED at once. On the face of it, that would seem to be a big problem. Don't worry. The LEDs change very quickly such that the eye is tricked into thinking multiple LEDs are lit at the same time. This means that your code that cannot be doing something else while the LEDs are lit. This is why the API accepts timing information. This is not what you'd expect if you are used to lighting LEDs directly from GPIO pins or via a shift register.</p>
<p><a href="https://devblogs.microsoft.com/dotnet/show-dotnet-animating-40-leds-with-charlieplexing/">Show dotnet: Animating 40 LEDs with charlieplexing</a> demonstrates using this binding.</p>
<h2 id="usage">Usage</h2>
<p>The following code sample demonstrates addressing 6 LEDs with 3 pins.</p>
<pre><code class="lang-csharp">
var pins = new int[] { 6, 13, 19 };
var ledCount = 6;
var charlie = new CharlieplexSegment(pins, ledCount);

for (int i = 0; i &lt; ledCount; i++)
{
    // will keep lit for 500ms
    charlie.Write(i, 1, 500);
    charlie.Write(i, 0);
}
</code></pre>
<p>The <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Charlieplex/samples/Program.cs">charlieplex-test sample</a> exercises a broader use of the API.</p>
<h2 id="using-with-leds">Using with LEDs</h2>
<p>The following image demonstrates a 3-pin charlieplex circuit, which is the starting point for charlieplexing. There are 6 LEDs in the circuit in groups of two. In each group of two, the LEDs connect to the same two GPIO pins, but with the opposite polarity (anode and cathodes are switched).</p>
<p><img src="https://user-images.githubusercontent.com/2608468/88128814-90e46000-cb8b-11ea-82a3-43cd8d2ce98d.jpg" alt="charlieplex"></p>
<p><a href="https://youtu.be/eR0fdzPZgcI">Video</a></p>
<h2 id="using-with-an-led-bar-graph">Using with an LED bar graph</h2>
<p>The image above demonstrates using LEDs within a charlieplex circuit. LEDs are straightforward to use since you can switch their anode/cathode orientation. You cannot do that with an <a href="https://www.adafruit.com/product/1815">LED bar graph</a> since the anode and cathode legs are fixed. Instead, you need to create your own circuit on a breadboard, and then feed that to the appropriate legs. That's what you see happening in the image below.</p>
<p><img src="https://user-images.githubusercontent.com/2608468/88133056-09e8b500-cb96-11ea-806b-374a9881e10d.jpg" alt="charlieplex"></p>
<p><a href="https://youtu.be/INu0yyVbmho">Video</a></p>
<h2 id="circuit-addressing-scheme">Circuit addressing scheme</h2>
<p>The <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Charlieplex/CharlieplexSegment.cs">CharlieplexSegment</a> type uses an addressing scheme that can be thought of as depth then breadth. Between each pair of pins, there are a pair of LEDs or other loads. The first LED is placed anode-first and the second is placed cathode-first. You start with the first two pins for the first pair of LEDs, and then the second and third pins for the second pair. This continues until you run out of pins. After that, you start from the first pin again, but this time pair with the third pin. This pattern continues until you reach the desired number of LEDs or run out of pins.</p>
<p>It is critical to understand the difference between anode (typically longer) and cathode legs of LEDs. You will be checking these with each placement.</p>
<p>The binding includes an API that returns a description of the circuit you need to use. The <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Charlieplex/samples/Program.cs">sample</a> calls this API and prints this information to the terminal, using the same pins as the code example above. This information is very helpful to have to configure the circuit correctly.</p>
<pre><code class="lang-console">Node 0 -- Anode: 6; Cathode: 13
Node 1 -- Anode: 13; Cathode: 6
Node 2 -- Anode: 13; Cathode: 19
Node 3 -- Anode: 19; Cathode: 13
Node 4 -- Anode: 6; Cathode: 19
Node 5 -- Anode: 19; Cathode: 6
</code></pre>
<p>The tests in <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/tree/develop/devices/Charlieplex/tests/CharlieplexLayout.cs">CharlieplexLayout.cs</a> call this same API and demonstrate the circuit address scheme with varying numbers of pins.</p>
<p>Given a 6 LED circut, <code>charlie.Write(5,1)</code> will light LED6 in the diagram. The API uses a 0-based scheme. As a result, <code>charlie.Write(6,1)</code> will throw an exception.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/2-pin_Charlieplexing_with_common_resistor.svg/1200px-2-pin_Charlieplexing_with_common_resistor.svg.png" alt="Two LED charlieplex circuit"></p>
<p>This image demonstrates a 2-pin circuit. There isn't any reason to use a 2-pin charlieplex circuit other than as a learning exercise.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/3-pin_Charlieplexing_with_common_resistors.svg/800px-3-pin_Charlieplexing_with_common_resistors.svg.png" alt="Three LED charlieplex circuit"></p>
<p>This image demonstrates a 3-pin circuit.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/3-pin_Charlieplexing_with_common_resistors.svg" alt="Six LED charliplex circuit"></p>
<p>This image demonstrates a 6-pin circuit.</p>
<p>The <a href="https://www.instructables.com/id/Controlling-20-Leds-from-5-Arduino-pins-using-Cha/">Controlling 20 Led's From 5 Arduino Pins Using Charlieplexing</a> includes larger wiring diagrams that match the scheme used by this binding.</p>
<h2 id="alternatives">Alternatives</h2>
<p>The alternative to a charlieplex circuit is a shift register. See <a href="../Sn74hc595/README.html">SN74HC595 -- 8-Bit Shift Register</a>. A shift register is even more efficient at using pins than a charlieplex circuit, and is simpler to configure.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Charlieplex/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

