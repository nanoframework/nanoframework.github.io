<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>LidarLiteV3 - LIDAR Time of Flight Sensor | .NET nanoFramework Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="LidarLiteV3 - LIDAR Time of Flight Sensor | .NET nanoFramework Documentation ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../x-cross/toc.html">
  
  <meta property="docfx:rel" content="../../">
  
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="lidarlitev3---lidar-time-of-flight-sensor">LidarLiteV3 - LIDAR Time of Flight Sensor</h1>

<p>This device belongs to a class of sensors known as time-of-flight, which measures distances by
calculating the time delay between signal transmission and reception of the signal as it bounces
off the subject. Unlike the popular sonar-based HC-SR04, this device uses a low-power laser. The
advantage is longer distances (up to 40m) but more prone to errors when the subject is reflective.</p>
<h2 id="documentation">Documentation</h2>
<p><a href="http://static.garmin.com/pumac/LIDAR_Lite_v3_Operation_Manual_and_Technical_Specifications.pdf">Official Manual and Technical Spec</a></p>
<h2 id="usage">Usage</h2>
<p><strong>Important</strong>: make sure you properly setup the I2C pins especially for ESP32 before creating the <code>I2cDevice</code>, make sure you install the <code>nanoFramework.Hardware.ESP32 nuget</code>:</p>
<pre><code class="lang-csharp">//////////////////////////////////////////////////////////////////////
// when connecting to an ESP32 device, need to configure the I2C GPIOs
// used for the bus
Configuration.SetPinFunction(21, DeviceFunction.I2C1_DATA);
Configuration.SetPinFunction(22, DeviceFunction.I2C1_CLOCK);
</code></pre>
<p>For other devices like STM32, please make sure you're using the preset pins for the I2C bus you want to use.</p>
<p>Simple usage:</p>
<pre><code class="lang-csharp">using (var llv3 = new LidarLiteV3(CreateI2cDevice()))
{
    // Take 10 measurements, each one second apart.
    for (int i = 0; i &lt; 10; i++)
    {
        Length currentDistance = llv3.MeasureDistance();
        Debug.WriteLine($&quot;Current Distance: {currentDistance.Centimeters} cm&quot;);
        Thread.Sleep(1000);
    }
}

I2cDevice CreateI2cDevice()
{
    var settings = new I2cConnectionSettings(1, LidarLiteV3.DefaultI2cAddress);
    return I2cDevice.Create(settings);
}

</code></pre>
<h3 id="power-modes">Power Modes</h3>
<p>Power can be controlled to the device via a GPIO pin. Use the optional constructor parameters to
specify the GPIO controller and a power enable pin number (numbering scheme depends on GpioController).</p>
<pre><code class="lang-csharp">int powerEnablePin = 13;
using (var llv3 = new LidarLiteV3(CreateI2cDevice(), new GpioController(), powerEnablePin))
{
    // Power off the device.
    llv3.PowerOff();
    // Device is completely turned off.
    Debug.WriteLine(&quot;Device is off.&quot;);
    Thread.Sleep(5000);
    // Power on the device, device is ready in ~22ms.
    Debug.WriteLine(&quot;Device is on.&quot;);
    llv3.PowerOn();
    // Sleep 50ms.
    Thread.Sleep(50);
    // Get a reading.
    Length currentDistance = llv3.MeasureDistance();
    Debug.WriteLine($&quot;Current Distance: {currentDistance.Centimeters} cm&quot;);
}
</code></pre>
<p>It's also possible to disable the receiver circuit (saving 40 mA) or put the device to sleep
(saving 20 mA).  However, it's recommended to use the power enable pin instead
since the initialization time is only 2 ms shorter.</p>
<pre><code class="lang-csharp">using (var llv3 = new LidarLiteV3(CreateI2cDevice()))
{
   llv3.PowerMode = PowerMode.Sleep;
}
</code></pre>
<h3 id="repetition-mode">Repetition Mode</h3>
<p>Instead of getting measurements on-demand, the device can be configure to repeat n number of
times, or infinitely.</p>
<p>This is configured via <code>SetMeasurementRepetitionMode</code> passing in a mode (<code>Off</code>, <code>Repeat</code>, or
<code>RepeatInfinitely</code>), a loop count (if mode is <code>Repeat</code>), and a delay between measurements (default to
10 hz). A delay of <code>20</code> is about <code>100 hz</code>.</p>
<p>With a repetition mode set, use <code>Distance</code> to retrieve the current readings in <code>Length</code>.
Use <code>DifferenceBetweenLastTwoDistances</code> to get a velocity reading.  Negative values
indicate that the object is moving toward the device, positive indicates it's moving away.  The value
is dependent on the delay, and the default 10 hz is about 0.1 m/s.</p>
<pre><code class="lang-csharp">using (var llv3 = new LidarLiteV3(CreateI2cDevice()))
{
    llv3.SetMeasurementRepetitionMode(MeasurementRepetitionMode.RepeatIndefinitely);

    while(true)
    {
        Thread.Sleep(5);
        Length currentDistance = llv3.Distance;
        Length currentVelocity = llv3.DifferenceBetweenLastTwoDistances;
    }
}
</code></pre>
<h3 id="change-the-i2c-address">Change the I2C Address</h3>
<p>By default, the device has an address of <code>0x62</code>.  It's possible to change this address to
resolve a conflict with another device or to run multiple devices.</p>
<p>Available addresses are 7-bit values with a 0 in the LSB order.</p>
<pre><code class="lang-csharp">using (var llv3 = new LidarLiteV3(CreateI2cDevice()))
{
    // Set device from default `0x62` to `0x68`
   llv3.SetI2cAddressAndDispose(0x68);
}

// Connect to the device again with the new address.
var settings = new I2cConnectionSettings(1, 0x68);
var i2cDevice = I2cDevice.Create(settings);

using (var llv3 = new LidarLiteV3(i2cDevice))
{
   // ...
}

</code></pre>
<h3 id="optimization">Optimization</h3>
<p>The default settings should work well, but several tweaks can be made to adjust the device.
See the manual for more details.</p>
<h4 id="change-acquistion-count">Change Acquistion Count</h4>
<p>To isolate the signal from the noise, the device performs a series of acquisitions and sums up the
result until a peak is found.  The number of acquistions can be configured via
<code>MaximumAcquisitionCount</code> (default: 128).</p>
<p>Less acquisitions result in faster measurements, but limits the max range and produces more
erroneous readings. The number roughly correlates to an acquistion rate of n/count and n^(1/4).</p>
<pre><code class="lang-csharp">using (var llv3 = new LidarLiteV3(CreateI2cDevice()))
{
    llv3.MaximumAcquisitionCount = 100
}
</code></pre>
<h4 id="quick-termination-mode">Quick Termination Mode</h4>
<p>Faster acquisition readings, but with slightly more chance of erroneous readings.</p>
<pre><code class="lang-csharp">using (var llv3 = new LidarLiteV3(CreateI2cDevice()))
{
    llv3.AcquistionMode |= AcquistionMode.EnableQuickTermination;
}
</code></pre>
<h4 id="detection-sensitivity">Detection Sensitivity</h4>
<p>The threshold when a peak is found can be configured via <code>AlgorithmByPassThreshold</code>.  By default,
this is 0 which uses an internal algorithm to determine the threshold.</p>
<p>Recommended non-default values are 32 for higher sensitivity but higher erronenous readings
and 96 for reduced sensitivity with fewer erroneous readings.</p>
<pre><code class="lang-csharp">using (var llv3 = new LidarLiteV3(CreateI2cDevice()))
{
    llv3.AlgorithmBypassThreshold = 32
}
</code></pre>
<h2 id="mcu-wiring">MCU Wiring</h2>
<p>The device communicates over I2C and while there's a PWN mode supported by the device, it is not
implemented.</p>
<p>I2C Wiring on the MCU:</p>
<table>
<thead>
<tr>
<th>LidarLiteV3 Wire</th>
<th>MCU GPIO Pin (Physical Numbering)</th>
</tr>
</thead>
<tbody>
<tr>
<td>5V (red)</td>
<td>5V</td>
</tr>
<tr>
<td>Ground (black)</td>
<td>Ground</td>
</tr>
<tr>
<td>Power enable (orange)</td>
<td>Optional, an available IO pin</td>
</tr>
<tr>
<td>Mode control (yellow)</td>
<td>Not used</td>
</tr>
<tr>
<td>I2C SCL (green)</td>
<td>SCL</td>
</tr>
<tr>
<td>I2C SDA (blue)</td>
<td>SDA</td>
</tr>
</tbody>
</table>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/devicesdetails/LidarLiteV3/README.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Copyright © 2018 nanoFramework Contributors<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
