<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>TLC1543 - 10-bit ADC with 11 input channels | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="TLC1543 - 10-bit ADC with 11 input channels | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Tlc1543/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="tlc1543---10-bit-adc-with-11-input-channels">TLC1543 - 10-bit ADC with 11 input channels</h1>

<p>High-speed 10-bit switched-capacitor successive-approximation A/D Converter with 14 channels (11 inputs and 3 self-test channels)</p>
<h2 id="documentation">Documentation</h2>
<ul>
<li>TLC1542/3 <a href="https://www.ti.com/lit/ds/symlink/tlc1543.pdf">Datasheet</a></li>
</ul>
<h2 id="usage">Usage</h2>
<h3 id="simple-line-finding-algorithm-with-adc-usage">Simple Line finding algorithm with ADC usage</h3>
<p>This sample shows how to calculate position of line under matrix of 5 IR sensors with the help of TLC1543 ADC. In this case it's AlphaBot2 Pi from WaveShare with ITR-20001 IR sensors.</p>
<h3 id="initialization">Initialization</h3>
<pre><code class="lang-csharp">SpiDevice spi = SpiDevice.Create(new SpiConnectionSettings(1, 5) { DataBitLength = Tlc1543.SpiDataBitLength });
</code></pre>
<h3 id="changing-charge-channel">Changing Charge Channel</h3>
<pre><code class="lang-csharp">adc.ReadPreviousAndChargeChannel(channels[0]);
</code></pre>
<p>You can set ChargeChannel to one of the Self Test channels (if you really know what you're doing you can also set it to one of the normal channels - but remember that this may amplify noise going from one channel to the other) if you know exactly what range of values you're expecting on polled channels (less interference on channels with fast changing but weak signals). Default set for SelfTest512 as that's the middle of 10 bit range.</p>
<h3 id="getting-data">Getting data</h3>
<pre><code class="lang-csharp">int values = adc.ReadPreviousAndChargeChannel(channels[0]);
</code></pre>
<p>Simple way of reading values into just made list.</p>
<h3 id="calculating-position">Calculating position</h3>
<pre><code class="lang-csharp">for (int i = 0; i &lt; values.Count; i++)
{
    if (values[i] &lt; 300)
    {
        lineAverage += (i - 2);
        onLine++;
    }
}
</code></pre>
<p>To find where under our matrix is line we need to check values given out from sensors depending on where they are pointing.</p>
<ul>
<li>Pointing at sky gives us values ranging from 0 to 50</li>
<li>Keeping it close to white paper gives values bigger than 600</li>
<li>Placing it pointed at black tape - taped on white paper(for contrast) gives values ranging from 150 to 250 on sensor exactly above line</li>
</ul>
<p>So to simplfy things we assume that when we run this program we won't be pointing our sensor matrix at the sky and we will keep it at a flat surface.</p>
<p>Next thing is to calculate average from sensors for when there are more than one sensors seeing line.</p>
<p>For example when first and second sensor sees line values will be</p>
<ul>
<li>on first loop <code>lineAverage = -2</code> and <code>onLine = 1</code>;</li>
<li>on second loop <code>lineAverage = -3</code> and <code>onLine = 2</code>;</li>
</ul>
<p>And now with this data we can calculate linePosition</p>
<pre><code class="lang-csharp">double linePosition = ((double)lineAverage / (double)onLine);
</code></pre>
<p><code>linePosition = -1.5</code></p>
<p>and we now know that the line is somewhere between first and second sensor. By using <code>(i - 2)</code> in our loop we moved values that the third sensor now indicates middle of the matrix, values less than zero are left from the middle and values above are on the right side. If we would have seven sensor matrix we would move those values by 3. Nine sensors? Move it by 4 - simple as that.</p>
<h2 id="binding-notes">Binding Notes</h2>
<p>Only mode implemented is Fast Mode 1 (10 clocks and !ChipSelect high between conversion cycles).
Respective timing diagram can be seen on figure 9 in datasheet.</p>
<p>It is possible to change ADC charge channel.</p>
<pre><code class="lang-csharp">adc.ReadPreviousAndChargeChannel(channels[0]);
</code></pre>
<p>Using EndOfConversion mode is not yet supported.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Tlc1543/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

