<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Hx711 (M5Stack WEIGHT) | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Hx711 (M5Stack WEIGHT) | .NET nanoFramework Documentation ">
    
      <link rel="shortcut icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../styles/docfx.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta property="docfx:navrel" content="../../toc.html">
      <meta property="docfx:tocrel" content="../../x-cross/toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="hx711-m5stack-weight">Hx711 (M5Stack WEIGHT)</h1>

<p>This is a library to interact with the Hx711 ADC. This is conveniently assembled and package in the M5Stack WEIGHT module.</p>
<p><img src="../../devicesimages/Hx711/weight_05.png" alt="weight_05.png"></p>
<h2 id="documentation">Documentation</h2>
<ul>
<li>The module documentation can be found <a href="https://docs.m5stack.com/en/unit/weight">here</a>.</li>
<li>Datasheet for the Hx711 ADC can be found <a href="https://m5stack.oss-cn-shenzhen.aliyuncs.com/resource/docs/datasheet/unit/HX711_en.pdf">here</a>.</li>
</ul>
<h2 id="usage">Usage</h2>
<h3 id="signals-and-connections">Signals and connections</h3>
<p>Check the connections for the WEIGTH module at the <a href="https://docs.m5stack.com/en/unit/weight">product page</a>.
From the schematic one can see these signals:</p>
<ul>
<li>DOUT: Grove connector pin 1</li>
<li>PDSCK: Grove connector pin 2</li>
</ul>
<p>Our code is using SPI to generate the clock signals and read back data from the HX711, so the connections need to match the SPI signals like this:</p>
<ul>
<li>MOSI -&gt; PDSCK</li>
<li>MISO -&gt; DOUT</li>
</ul>
<p>SPI clock is not used so feel free to route to an unused GPIO.
There is also no need for the CS signal so no need to define a pin for it.</p>
<p><strong>Important</strong>: make sure you setup the SPI pins for ESP32 before creating the <code>Scale</code>. For this, make sure you install the <code>nanoFramework.Hardware.ESP32</code> NuGet.</p>
<pre><code class="lang-csharp">///////////////////////////////////////////////////////////////////////
// When connecting to an ESP32 device, need to configure the SPI GPIOs
// The following mapping is used in order to connect the WEIGTH module
// to a M5Core device using the Grove port A
// MOSI: connects to WEIGHT Grove pin 2
// MISO: connects to WEIGHT Grove pin 1
// CLOCK: connect to any free port as it's not used at all
Configuration.SetPinFunction(21, DeviceFunction.SPI1_MOSI);
Configuration.SetPinFunction(22, DeviceFunction.SPI1_MISO);
Configuration.SetPinFunction(23, DeviceFunction.SPI1_CLOCK);
</code></pre>
<blockquote>
<p><strong>Warning</strong>
Make sure to follow the instructions above. At first glance they can look contrary to the naming of the signals and schematics in M5Stack documentation. That's because the GROVE connectors are meant to use I2C and their implementation of the driver is different from ours.</p>
</blockquote>
<p>For other devices, like STM32, please make sure you're using the pins for the UART you want to use.</p>
<h3 id="configuring-spi">Configuring SPI</h3>
<pre><code class="lang-csharp">// setup SPI connection settings
// the clock value was adjusted in order to get the typical duration expected by the PD_SCK ~1us
var spisettings = new SpiConnectionSettings(1)
{
    ClockFrequency = Scale.DefaultClockFrequency
};

// create SPI device
var spidev = SpiDevice.Create(spisettings);

// create scale
var scale = new Scale(spidev);
</code></pre>
<p>The scale class is very simple to use and offers some configurations. Let's explore the most common usage scenarios.</p>
<h3 id="taring-a-scale">Taring a scale</h3>
<p>Taring is used to exclude a measurement from the total weight given by the scale. Most commonly, this function is used to negate the weight of the container or other elements attached to the scale.</p>
<pre><code class="lang-csharp">// set scale tare to get accurate readings
scale.Tare();
</code></pre>
<h3 id="reading-the-weight">Reading the weight</h3>
<p>To take a reading of the weight on the load cell just need to call <code>Read</code>. The following code snippet will read the weight continuously and output the value to the output pane.</p>
<pre><code class="lang-csharp">
// loop forever outputting the current reading
while (true)
{
    var reading = scale.Read();

    Console.WriteLine($&quot;Weight: {reading}&quot;);

    Thread.Sleep(2_000);
}
</code></pre>
<h3 id="settings-and-configurations">Settings and configurations</h3>
<p>The library exposes several configurations. Please explore the documentation here.</p>
<h2 id="acknowledgments">Acknowledgments</h2>
<p>The development of this library was kindly sponsored by <a href="https://greenyng.com/">greenYng</a>!</p>
<p><img src="../../devicesimages/Hx711/greenyng-logo.png" alt="greenyng-logo.png"></p>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/devicesdetails/Hx711/README.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Copyright © 2023 nanoFramework Contributors<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
