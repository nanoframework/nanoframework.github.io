<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Hx711 (M5Stack WEIGHT) | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Hx711 (M5Stack WEIGHT) | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Hx711/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="hx711-m5stack-weight">Hx711 (M5Stack WEIGHT)</h1>

<p>This is a library to interact with the Hx711 ADC. This is conveniently assembled and package in the M5Stack WEIGHT module.</p>
<p><img src="../../devicesimages/Hx711/weight_05.png" alt="weight_05.png"></p>
<h2 id="documentation">Documentation</h2>
<ul>
<li>The module documentation can be found <a href="https://docs.m5stack.com/en/unit/weight">here</a>.</li>
<li>Datasheet for the Hx711 ADC can be found <a href="https://m5stack.oss-cn-shenzhen.aliyuncs.com/resource/docs/datasheet/unit/HX711_en.pdf">here</a>.</li>
</ul>
<h2 id="usage">Usage</h2>
<h3 id="signals-and-connections">Signals and connections</h3>
<p>Check the connections for the WEIGTH module at the <a href="https://docs.m5stack.com/en/unit/weight">product page</a>.
From the schematic one can see these signals:</p>
<ul>
<li>DOUT: Grove connector pin 1</li>
<li>PDSCK: Grove connector pin 2</li>
</ul>
<p>Our code is using SPI to generate the clock signals and read back data from the HX711, so the connections need to match the SPI signals like this:</p>
<ul>
<li>MOSI -&gt; PDSCK</li>
<li>MISO -&gt; DOUT</li>
</ul>
<p>SPI clock is not used so feel free to route to an unused GPIO.
There is also no need for the CS signal so no need to define a pin for it.</p>
<p><strong>Important</strong>: make sure you setup the SPI pins for ESP32 before creating the <code>Scale</code>. For this, make sure you install the <code>nanoFramework.Hardware.ESP32</code> NuGet.</p>
<pre><code class="lang-csharp">///////////////////////////////////////////////////////////////////////
// When connecting to an ESP32 device, need to configure the SPI GPIOs
// The following mapping is used in order to connect the WEIGTH module
// to a M5Core device using the Grove port A
// MOSI: connects to WEIGHT Grove pin 2
// MISO: connects to WEIGHT Grove pin 1
// CLOCK: connect to any free port as it's not used at all
Configuration.SetPinFunction(21, DeviceFunction.SPI1_MOSI);
Configuration.SetPinFunction(22, DeviceFunction.SPI1_MISO);
Configuration.SetPinFunction(23, DeviceFunction.SPI1_CLOCK);
</code></pre>
<blockquote>
<p><strong>Warning</strong>
Make sure to follow the instructions above. At first glance they can look contrary to the naming of the signals and schematics in M5Stack documentation. That's because the GROVE connectors are meant to use I2C and their implementation of the driver is different from ours.</p>
</blockquote>
<p>For other devices, like STM32, please make sure you're using the pins for the UART you want to use.</p>
<h3 id="configuring-spi">Configuring SPI</h3>
<pre><code class="lang-csharp">// setup SPI connection settings
// the clock value was adjusted in order to get the typical duration expected by the PD_SCK ~1us
var spisettings = new SpiConnectionSettings(1)
{
    ClockFrequency = Scale.DefaultClockFrequency
};

// create SPI device
var spidev = SpiDevice.Create(spisettings);

// create scale
var scale = new Scale(spidev);
</code></pre>
<p>The scale class is very simple to use and offers some configurations. Let's explore the most common usage scenarios.</p>
<h3 id="taring-a-scale">Taring a scale</h3>
<p>Taring is used to exclude a measurement from the total weight given by the scale. Most commonly, this function is used to negate the weight of the container or other elements attached to the scale.</p>
<pre><code class="lang-csharp">// set scale tare to get accurate readings
scale.Tare();
</code></pre>
<h3 id="reading-the-weight">Reading the weight</h3>
<p>To take a reading of the weight on the load cell just need to call <code>Read</code>. The following code snippet will read the weight continuously and output the value to the output pane.</p>
<pre><code class="lang-csharp">
// loop forever outputting the current reading
while (true)
{
    var reading = scale.Read();

    Console.WriteLine($&quot;Weight: {reading}&quot;);

    Thread.Sleep(2_000);
}
</code></pre>
<h3 id="settings-and-configurations">Settings and configurations</h3>
<p>The library exposes several configurations. Please explore the documentation here.</p>
<h2 id="acknowledgments">Acknowledgments</h2>
<p>The development of this library was kindly sponsored by <a href="https://greenyng.com/">greenYng</a>!</p>
<p><img src="../../devicesimages/Hx711/greenyng-logo.png" alt="greenyng-logo.png"></p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Hx711/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

