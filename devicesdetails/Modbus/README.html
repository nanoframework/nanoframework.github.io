<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Modbus - Machine to machine communication protocol | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Modbus - Machine to machine communication protocol | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Modbus/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="modbus---machine-to-machine-communication-protocol">Modbus - Machine to machine communication protocol</h1>

<p>Modbus communication protocol addresses architectures for distributed automation systems across multiple market segments. It can be serial port based or network based. This implementation is serial port based but can be adjusted to support networking easily.</p>
<h2 id="documentation">Documentation</h2>
<p>Modbus specifications can be found on the <a href="https://www.modbus.org/specs.php">Modbus organization website</a>.</p>
<h2 id="usage">Usage</h2>
<p>If you are using an ESP32, you must initialize the pins to use serial port like this:</p>
<pre><code class="lang-csharp">// SerialPort COM2
Configuration.SetPinFunction(16, DeviceFunction.COM2_RX);
Configuration.SetPinFunction(17, DeviceFunction.COM2_TX);
Configuration.SetPinFunction(18, DeviceFunction.COM2_RTS);
</code></pre>
<p>With an ESP32, you can almost use any pin for any function. When using an STM32 or other MCU, the pins are usually fixed. Refer to the documentation of your MCU to understand which pin to use.</p>
<h3 id="modbus-client">Modbus client</h3>
<p>To initialize and use a Modbus client, you can do the following:</p>
<pre><code class="lang-csharp">// Modbus Client
var client = new ModbusClient(&quot;COM3&quot;);
client.ReadTimeout = client.WriteTimeout = 2000;

client.WriteMultipleRegisters(2, 0x5, new ushort[] { 3, 5, 2, 3 });
client.Raw(2, FunctionCode.Diagnostics, new byte[] { 0x01, 0x01, 0x01, 0x01 });

var data1 = client.ReadHoldingRegisters(2, 0x7, 4);
var data2 = client.ReadCoils(2, 0x23, 2);
</code></pre>
<p>As shown in the sample, you have the possibility to write multiple registers, use raw function and also ready multiple registers.</p>
<h3 id="modbus-server">Modbus server</h3>
<p>A server implementation is also available:</p>
<pre><code class="lang-csharp">// Modbus Server
var server = new ModbusServer(new Device(1), &quot;COM2&quot;);
server.ReadTimeout = server.WriteTimeout = 2000;
server.StartListening();
</code></pre>
<p>This server implementation will allow you to act as a server. It can be extended.</p>
<h2 id="hardware-implementation">Hardware implementation</h2>
<p>When using Modbus with an RS485, you can for example use a MAX485 to make the interface between the traditional serial port and RS485:</p>
<p><img src="../../devicesimages/Modbus/MAX485.png" alt="MAX485"></p>
<h2 id="rs232-support">RS232 support</h2>
<p>You can change the <code>mode</code> parameter in constructor to 0 (SerialMode.Normal) if you're using Modbus over RS232</p>
<pre><code class="lang-csharp">// Modbus Client
var client = new ModbusClient(&quot;COM3&quot;,SerialMode.Normal); 
// Modbus Server
var server = new ModbusServer(new Device(1), &quot;COM2&quot;,mode:SerialMode.Normal);
</code></pre>
<h2 id="limitations">Limitations</h2>
<p><strong>NOTE:</strong> nanoFramework only (currently) supports the &quot;Modbus-RTU&quot; protocol.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/Modbus/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

