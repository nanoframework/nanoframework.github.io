<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>QTR Sensors - Pololu QTR Reflectance Sensors | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="QTR Sensors - Pololu QTR Reflectance Sensors | .NET nanoFramework Documentation ">
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/QtrSensors/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="qtr-sensors---pololu-qtr-reflectance-sensors">QTR Sensors - Pololu QTR Reflectance Sensors</h1>

<p>Those sensors are popular on small robots to have scenarios like line following. They provide a way to calibrate, read, and provide high level functions to help in line following.</p>
<p>While this implementation has been tested with reflectance sensors, this will work with any type of analogic sensor. The original design have the sensors lining up but the shape of the sensors can be anything. Just keep in mind that the ReadPosition function will not be relevant if you don't have the sensors aligned.</p>
<h2 id="documentation">Documentation</h2>
<p>Official documentation can be fond <a href="https://www.pololu.com/category/123/pololu-qtr-reflectance-sensors">here</a>.</p>
<h2 id="qtr-sensors">QTR Sensors</h2>
<p>You will find different implementation of those. All implementations from Pololu have aligned sensors. Some others may have different implementation. The present implementation is only for analogic sensors. It will not only work with Pololu sensors but with any analogic sensors. They have to have 1 or 2 common emitters.</p>
<h2 id="usage">Usage</h2>
<p>You can create q QtrAnalog sensor with an array of GPIO for the individual sensors and an array of 0 or 1 or 2 GPIO for the emitter.</p>
<pre><code class="lang-csharp">// In this case, we will use 1 emitter and 5 sensors
QtrAnalogic qtr = new(new int[] { 33, 14, 26, 4, 13 }, new int[] { 15 });
</code></pre>
<h3 id="calibration">Calibration</h3>
<p>It is recommended to calibrate the sensors on the surface you are going to use without any line or perturbation. This will increase the accuracy of the line detection if you're using this scenario.</p>
<pre><code class="lang-csharp">var calibOn = qtr.Calibrate(10, true);
var calibOff = qtr.Calibrate(10, false);
</code></pre>
<h3 id="samples-per-sensor-emitters-and-emitter-values">Samples per sensor, emitters and emitter values</h3>
<p>You can adjust the number or reads you'll do per sensor. The read value will be averaged. Keep in mind that reading the sensor is taking time, so the more you read, the more time it takes. If you are using a robot scenario, try to limit the sapling if it is moving fast.</p>
<pre><code class="lang-csharp">// This will read each sensor 5 times
qtr.SamplesPerSensor = 5;
</code></pre>
<p>You can as well adjust the sensor emitter pins to either on or off and choose to have all of them, none, even or odds one. The combination will allow you to find a flexible way depending on your scenario. And you can as well do not create the QTR Sensors with emitter pins and manage them yourself.</p>
<pre><code class="lang-csharp">qtr.EmitterSelection = EmitterSelection.All;
qtr.EmitterValue = PinValue.High;
</code></pre>
<p>Note this has impact on the measurement. The calibration can be preformed for the 2 scenarios: with the emitter on and off.</p>
<h3 id="read-raw-values">Read raw values</h3>
<p>You can get the raw values without calibration by using the <code>ReadRaw</code> function. This will give the values as they are without using any calibration.</p>
<pre><code class="lang-csharp">// Raws is an array of double
var raws = qtr.ReadRaw();
</code></pre>
<h3 id="read-ratio-value">Read ratio value</h3>
<p>You can get normalized reading of the data using the calibration if you've done it. The results will be between 0 and 1.0</p>
<pre><code class="lang-csharp">var ratios = qtr.ReadRatio();
</code></pre>
<h3 id="read-position-values">Read position values</h3>
<p>This is useful in line following scenarios. You can get a position between -1.0 and +1.0 where 0.0 is the middle, meaning it has detected in the middle of the sensors.</p>
<pre><code class="lang-csharp">// By default it will read black/dark lines out of a white/clear background
var pos = qtr.ReadPosition();
</code></pre>
<p>Note: the sensor will keep the last position, so if you were close to -1 and the line is not detected, it will continue to give you -1. Same for +1. Arbitrary, -1 is used for the first GPIO number you gave in the constructor and +1 for the last one.</p>
<p>This is using normalized and pondered data to provide this value.</p>
<pre><code class="lang-csharp">// This will read the position of a white/clear line on a black/dark background
var pos = qtr.ReadPosition(false);
</code></pre>
<h2 id="current-implementation">Current implementation</h2>
<p>QTR Sensors type:</p>
<ul>
<li>[x] Analog QTR sensors</li>
<li>[ ] Digital QTR sensors</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.IoT.Device/blob/develop/devices/QtrSensors/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

