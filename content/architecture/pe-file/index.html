<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>.NET nanoFramework PE File Format | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content=".NET nanoFramework PE File Format | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../../favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/content/architecture/pe-file/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="net-nanoframework-pe-file-format">.NET <strong>nanoFramework</strong> PE File Format</h1>

<p>The .NET <strong>nanoFramework</strong> PE data format is based on the ECMA-335 specification. Specifically sections II.22 - II.24.
Due to the constraints of the systems .NET <strong>nanoFramework</strong> targets the PE file format is not an exact match/implementation of the ECMA-335 specification. .NET <strong>nanoFramework</strong> PE file format is essentially an extended subset of the format defined in ECMA-335.</p>
<h2 id="major-differences-from-ecma-335">Major differences from ECMA-335</h2>
<ul>
<li>The number and size of the metadata tables is limited in .NET <strong>nanoFramework</strong> to keep the overall memory footprint as low as possible.</li>
<li>The Windows PE32/COFF header, tables and information is stripped out.</li>
<li>Switch instruction branch table index is limited to 8 bits.</li>
<li>Table indexes are limited to 12 bits.</li>
<li>This also means that the metadata tokens are 16 bits and not 32 so the actual IL instruction stream is different for .NET <strong>nanoFramework</strong>.</li>
<li>Resources are handled in a very different manner with their own special table in the assembly header.</li>
</ul>
<h2 id="file-data-structure">File Data Structure</h2>
<p>The PE file starts with an <a href="AssemblyHeader.html">Assembly header</a> which is the top level structure of every .NET <strong>nanoFramework</strong> PE file. On disk the AssemblyHeader structure is at offset 0 of the .PE file. On the device the AssemblyHeader is aligned at a 32 bit boundary within a well known ROM/FLASH region (the Deployment region) with the first assembly at offset 0 of the region. Immediately following the assembly header is the metadata table data. Since there are no fixed requirements that an assembly requires all possible tables or what the number of entries in each table will be, the exact size and location of the start of each table's data is entirely described within the header including the end of the assembly, which is used to compute the start location of any subsequent assemblies in memory.</p>
<pre><code class="lang-text">+-----------------+ &lt;--- Aligned to 32 bit boundary in memory
| AssemblyHeader  |
+-----------------+
| Metadata        |
+-----------------+
| { padding }     |
+-----------------+ &lt;--- Aligned to 32 bit boundary in memory
| AssemblyHeader  |
+-----------------+
| Metadata        |
+-----------------+
| { padding }     |
+-----------------+ &lt;--- Aligned to 32 bit boundary in memory
|  ...            |
</code></pre>
<h2 id="structures-for-the-other-table-entries">Structures for the other table entries</h2>
<ul>
<li><p><a href="AssemblyRefTableEntry.html">AssemblyRef Table</a></p>
</li>
<li><p><a href="AttributeTableEntry.html">Attribute Table</a></p>
</li>
<li><p><a href="ExceptionHandlerTableEntry.html">ExceptionHandler Table</a></p>
</li>
<li><p><a href="FieldRefTableEntry.html">FieldRef Table</a></p>
</li>
<li><p><a href="MethodDefTableEntry.html">MethodDef Table</a></p>
</li>
<li><p><a href="MethodRefTableEntry.html">MethodRef Table</a></p>
</li>
<li><p><a href="ResourcesTableEntry.html">Resources Table</a></p>
</li>
<li><p><a href="TypeDefTableEntry.html">TypeDef Table</a></p>
</li>
<li><p><a href="TypeRefTableEntry.html">TypeRef Table</a></p>
</li>
<li><p><a href="TypeSpecTableEntry.html">TypeSpec Table</a></p>
</li>
<li><p><a href="GenericParamTableEntry.html">GenericParam Table</a> (new in v2.0)</p>
</li>
<li><p><a href="MethodSpecTableEntry.html">MethodSpec Table</a> (new in v2.0)</p>
</li>
<li><p><a href="Common-PE-Types-and-Enumerations.html">Common PE Types and Enumerations</a></p>
<blockquote>
<p>Note 1: The structures above are packed with 1 byte boundary.
Note 2: the documentation for the PE file format was taken from the original one at .NET Micro Framework.</p>
</blockquote>
</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/content/architecture/pe-file/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
