<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Package and assembly versions and checksums | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Package and assembly versions and checksums | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/content/architecture/guide-version-checksums.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="package-and-assembly-versions-and-checksums">Package and assembly versions and checksums</h1>

<p>Much of the .NET <strong>nanoFramework</strong> is made up of C# classes that invoke code that is in native C++ assemblies.  Some assemblies are just generic C++, others are specific to a hardware platform.</p>
<p>There is an interop framework that assists in handling the interface between C# and C++. That framework includes the generation of a checksum for a given interface contract, and a version checking mechanism to make sure that versions are updated when the contract (and checksum) change.</p>
<h2 id="how-the-checksum-is-generated">How the checksum is generated</h2>
<p>As with all of dotnet the nfproj file is actually a MSBuild XML configuration file. Part of the nanoFramework is the <code>meta-data-processor</code> (MDP) which is invoked as a post-build task in the MSBuild of the nfproj.</p>
<p>During the post-build the MDP creates stub C++ files for any interfaces that are declared as <code>InternalCall</code>.  The stub files are located at bin\debug\stubs\[assembly-name].  The calculated checksum is found in the corlib_native.cpp file. The MDP also emits the checksum as an environmental variable and later that is used to embed the checksum in the Portable Executable (PE) file that the nanoFramework actually runs. Below is a screen print taken from a stub of mscorlib with a checksum of 0x132BDB6F, and required native assembly version of 100.5.0.12:</p>
<blockquote>
<p><img src="../../images/getting-started-guides/mscorlib-corlib-native_cpp_declaration.png" alt="mscorlib corlib_native.cpp declaration"></p>
</blockquote>
<h2 id="how-the-required-native-version-is-defined">How the required native version is defined</h2>
<p>The required native version is set manually by a developer in the AssemblyInfo.cs file for the assembly.  The MDP will copy that information and also place it in the stub file corlib_native.cpp.  Here is a screen print of the CoreLibrary AssemblyInfo.cs file:</p>
<blockquote>
<p><img src="../../images/getting-started-guides/assemblyinfo-cs.png" alt="mscorlib AssemblyInfo.cs declaration"></p>
</blockquote>
<h2 id="manual-process-to-update-native-assembly-checksum-and-version">Manual process to update native assembly checksum and version</h2>
<p>Each native assembly has a corlib_native.cpp (and .h) file.  A developer manually copies any interface changes generated by the MDP stub generation process into the CPP files actually used by the native assembly.  They are very careful to copy the new checksum and to accept a new version number if the checksum has changed due to an interface/contract change.</p>
<h2 id="how-the-nuget-package-version-is-generated">How the NuGet package version is generated</h2>
<p>The assemblies in the nanoFramework use the nerdBank GitVersion NuGet component to manage NuGet versions.  There is a version.json file in the GIT repository root - here is a screen print for CoreLibrary:</p>
<blockquote>
<p><img src="../../images/getting-started-guides/mscorlib-version-json.png" alt="mscorlib AssemblyInfo.cs declaration"></p>
</blockquote>
<p>The {height} placeholder is filled out by the nerdBank component.  It is the number of commits since the last time the version.json file was changed to a new version number.  Note that the number will always increment, but it is not like a build number in that you may not start at 1, and it may not increment by 1.  But the version number will always be numeric and greater than the previous version.  Changing the version info in the file will cause the counter to start back around 1 - this depends on how many commits are in the first build after updating the version info.</p>
<p>The developer manually updates the NuGet package version prefix when there are breaking changes to the interface and a new checksum is needed.  In the preceding example the developer changed the prefix from 1.10.4 to 1.10.5.  Code changes that do not change the contract (and the checksum) will just get a new &quot;height&quot; as changes are committed and built.</p>
<p>The checksum and required native version are included in the description for the NuGet package.  Here is what that looks like for CoreLibrary:</p>
<blockquote>
<p><img src="../../images/getting-started-guides/core-library-nuget-version.png" alt="CoreLibrary NuGet version">
Note: In this example a bug in the build process caused the required native assembly version number to not be copied to the description correctly.</p>
</blockquote>
<h2 id="firmware-versions-and-native-assembly-versions">Firmware versions and native assembly versions</h2>
<p>Firmware is built automatically for a standard set of device targets.  The firmware version is independent from the assembly versions, but the latest firmware always uses the latest native assembly versions and will work with the latest NuGet package versions of a component. Here is a screen shot of <code>nanoff</code> installing the latest preview version of the firmware from the Cloudsmith.io repository:</p>
<blockquote>
<p><img src="../../images/getting-started-guides/nanoff-flash-latest-preview.png" alt="nanoff Flash latest preview"></p>
</blockquote>
<p>Here are two screen shots from using the <strong>Device Capabilities</strong> of the <strong>Device Explorer</strong> in Visual Studio to see what version of the firmware is installed, and then what native assembly versions (and checksums) were included in that firmware version:</p>
<blockquote>
<p><img src="../../images/getting-started-guides/device-capabilities-firmware-version.png" alt="device capabilities firmware version">
<img src="../../images/getting-started-guides/native-assembly-versions.png" alt="device capabilities native assembly versions"></p>
</blockquote>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/content/architecture/guide-version-checksums.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
