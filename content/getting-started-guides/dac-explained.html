<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>All what you&#39;ve always wanted to know about DAC | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="All what you&#39;ve always wanted to know about DAC | .NET nanoFramework Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../x-cross/toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/content/getting-started-guides/dac-explained.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="all-what-youve-always-wanted-to-know-about-dac">All what you've always wanted to know about DAC</h1>

<p>This beginner document will explain what is DAC and how to properly use it with concrete examples using .NET nanoFramework. You're in a perfect place if you want to have analogic work done and creating analogic values from a pin.</p>
<h2 id="a-bit-of-theory">A bit of theory</h2>
<p>In the world of microcontrollers (MCU), a Digital-to-Analog Converter (DAC) serves as a component that performs the opposite function of an <a href="adc-explained.html">ADC (Analog-to-Digital Converter)</a>. The DAC takes digital data from the MCU and converts it into an analog signal. This analog signal is then utilized to produce an output that can vary in voltage, current, or another analog form.</p>
<p>DACs are pivotal in scenarios where the MCU needs to interact with analog systems, such as generating audio signals, controlling motors, regulating voltage levels, or producing variable voltages for sensors. They allow the MCU to convert digital information into analog signals, enabling the control and manipulation of analog components or systems.</p>
<h2 id="a-bit-of-electronics-theory">A bit of electronics theory</h2>
<p>DAC are complex electronic circuits and are not found on every pins, usually they are reserves for fes pins. They are using as most things the Ohms law and summing the voltage divided by the invert of the bit level resistor.</p>
<p>Iy can be summarize as an equivalent electronic schema like this:</p>
<p><img src="../../images/getting-started/dac-electronic.png" alt="dac electronic schema"></p>
<p>Long story short and math short, when applying in this logical schema for a 4 bytes ADC convertor, each resistor power adds up with an operational amplifier and you will get the Vout as a result.</p>
<p>This electronic representation is one of the possible. There are other possible more precise like <a href="https://en.wikipedia.org/wiki/Resistor_ladder">R-2R ladder circuit</a>. They have all the same goal: from a digital input translated into bits creating an analogic representation.</p>
<p>Here, as you can see in the example, you have a resolution in bits. The high the number is, the more precise the resolution is. In out simple example, a 4 bits resolution will represent a poor 16 different values between negative and positive and positive reference voltage. If like most sound sound cards, you go for 16 bits, you'll already get 65536 possible values!</p>
<div class="NOTE">
<h5>Note</h5>
<p>If you want to use higher voltages you have to use a voltage level shifter or equivalent. This device will transform your applied voltage to another one, usually higher. Now, be careful in the choice as the response time for such device can be slow and only tolerate small changes. So chose them wisely depending on your usage.</p>
</div>
<h2 id="dac-in-practice">DAC in practice</h2>
<p>Most of the time you will use DAC to represent a signal that is not a simple square one as for this you have better opportunities like PWM. You can for example represent sinusoidal, triangles and even more!</p>
<p><img src="../../images/getting-started/dac-sine-wave.jpg" alt="sinusoidal"></p>
<p><img src="../../images/getting-started/dac-triangle-wave.jpg" alt="triangle"></p>
<p>And a nice traditional square because, yes, you can do it!</p>
<p><img src="../../images/getting-started/dac-square-wave.jpg" alt="square"></p>
<p>The core elements to create a DAC square shape uses:</p>
<pre><code class="lang-csharp">DacController dac = DacController.GetDefault();
// open channel 0
DacChannel dacChannel = dac.OpenChannel(0);
// get DAC resolution
dacResolution = dac.ResolutionInBits;
int timeResolution = 5;
int value = 0;
int upperValue;
int periodCounter = 0;
int halfPeriod;

// get upper value from DAC resolution
upperValue = (int)Math.Pow(2.0, dacResolution);

// figure out an expedite way to get a more or less square wave from the DAC and time resolution
halfPeriod = ( upperValue / (timeResolution * 10) ) / 2;

while(true)
{
    if (periodCounter == halfPeriod)
    {
        // tweak the value so it doesn't overflow the DAC
        value = upperValue - 1;
    }
    else if (periodCounter == halfPeriod * 2)
    {
        value = 0;

        periodCounter = 0;
    }

    channel.WriteValue((ushort)value);
    //Output the current value to console when in debug.
    Debug.WriteLine($&quot;DAC SquareWave output current value: {value}&quot;);
    Thread.Sleep(timeResolution);
    periodCounter++;
}
</code></pre>
<p>If you compare with <a href="adc-explained.html">ADC</a>, this code is a bit more complex. This is related to the fact that ADC only reads data while DAC is actually producing them. So if you want to create something with them, you have to create it and it can take quite some code for it!</p>
<h2 id="how-to-use-daccontroller-and-dacchannel">How to use DacController and DacChannel</h2>
<p>As shown in the previous example the <a href="https://docs.nanoframework.net/api/System.Device.Dac.DacController.html">DacController</a> allows to select a controller representing DAC. Some boards may have multiple ones. Its role is mainly to open DAC pins. Those are called channels.</p>
<div class="NOTE">
<h5>Note</h5>
<p>You need to refer to the documentation of your MCU to understand which channel to use. There may not be the same number as the pin number.</p>
</div>
<p>The <code>ResolutionInBits</code> will give you the resolution of the DAC.</p>
<p>The <a href="https://docs.nanoframework.net/api/System.Device.Dac.DacChannel.html">DacChannel</a> class represent the pin itself. The main function to use is <code>WriteValue</code> which takes a <code>ushort</code> which is a 16 bits data type. So values goes from 0 (representing low, 0) to 65535 (representing high, 1). Depending on your MCU, the resolution may be lower than this one.</p>
<h2 id="dac-specific-challenges">DAC specific challenges</h2>
<p>There are few important challenges to understand and take into account when using DAC.</p>
<p>The output of a DAC is usually a fraction of a reference voltage (Vref) or a range of voltage with a Vrefmin and Vrefmax, which can be an internal reference voltage or an externally supplied one. The Vrefmin and Vrefmax will allow you to set for example -5 V for the Vrefmin and +5 V for the Vrefmax. The accuracy of this reference voltage can affect the accuracy of the DAC's output. Always check your MCU datasheet to understand how to best use this.</p>
<p>The speed at which a DAC can update its output can be a limiting factor in some applications. This is often defined by the DAC's settling time, which is the time it takes for the output to settle within a specified error band following a change in the input. And it is also restricted by how fast you can call the function to change the values.</p>
<p>GitHub Copilot: The specific challenges of using a Digital-to-Analog Converter (DAC) can include:</p>
<p>All DACs introduce some amount of noise and distortion into their output signals. This can be a significant issue in sensitive applications, such as audio or high-precision measurement systems.</p>
<p>As you're generating the signal, creating complex waveforms can require more complex code compared to reading data with an ADC.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/content/getting-started-guides/dac-explained.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
